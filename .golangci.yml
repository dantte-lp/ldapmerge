# golangci-lint v2 configuration
# Run: golangci-lint run
# Docs: https://golangci-lint.run/docs/configuration/file/

version: "2"

run:
  timeout: 5m
  modules-download-mode: readonly
  allow-parallel-runners: true
  go: '1.25'

output:
  formats:
    - format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  sort-results: true

formatters:
  enable:
    - gofmt
    - goimports

linters:
  default: standard
  enable:
    # Additional linters beyond standard set
    - bodyclose        # HTTP response body close checker
    - dupl             # Code duplication detector
    - errname          # Error naming conventions
    - errorlint        # Error handling best practices
    - exhaustive       # Enum switch exhaustiveness
    - gocognit         # Cognitive complexity
    - goconst          # Repeated strings to constants
    - gocritic         # Various checks
    - gocyclo          # Cyclomatic complexity
    - gosec            # Security issues
    - misspell         # Spelling mistakes
    - nakedret         # Naked returns
    - nilerr           # nil error returns
    - nilnil           # nil,nil returns
    - noctx            # HTTP requests without context
    - prealloc         # Slice preallocation
    - predeclared      # Shadowing predeclared identifiers
    - revive           # Fast, configurable linter
    - sqlclosecheck    # SQL rows/stmt close checker
    - unconvert        # Unnecessary type conversions
    - unparam          # Unused function parameters
    - whitespace       # Whitespace issues

  disable:
    - depguard         # Dependency guard (too strict)
    - funlen           # Function length (handled by gocognit)
    - gochecknoglobals # Global variables (we use them intentionally)
    - lll              # Line length (too strict)
    - wsl              # Whitespace linter (too opinionated)

  settings:
    errcheck:
      check-type-assertions: true
      check-blank: false
      exclude-functions:
        - io.Copy
        - io.WriteString
        - time.Parse
        - strconv.ParseBool

    govet:
      enable-all: true
      disable:
        - fieldalignment  # Too strict for this project

    gocyclo:
      min-complexity: 20

    gocognit:
      min-complexity: 30

    dupl:
      threshold: 150

    goconst:
      min-len: 3
      min-occurrences: 3

    misspell:
      locale: US

    gocritic:
      enabled-tags:
        - diagnostic
        - style
        - performance
      disabled-checks:
        - hugeParam        # Too strict
        - rangeValCopy     # Too strict
        - unnamedResult    # Too strict for simple functions
        - octalLiteral     # We use both styles intentionally
        - paramTypeCombine # Style preference

    revive:
      rules:
        - name: blank-imports
        - name: context-as-argument
        - name: context-keys-type
        - name: dot-imports
        - name: error-return
        - name: error-strings
        - name: error-naming
        - name: exported
        - name: increment-decrement
        - name: indent-error-flow
        - name: package-comments
        - name: range
        - name: receiver-naming
        - name: time-naming
        - name: unexported-return
        - name: var-declaration
        - name: var-naming

    gosec:
      excludes:
        - G104  # Audit errors not checked (handled by errcheck)
        - G304  # File path provided as taint input (false positives)

    nakedret:
      max-func-lines: 30

  exclusions:
    generated: lax
    paths:
      - "mock"
      - "_test\\.go$"
    rules:
      # Exclude some linters from running on tests
      - path: _test\.go
        linters:
          - dupl
          - gosec
          - goconst
          - gocognit

      # Exclude some linters from running on mock/test utilities
      - path: mock
        linters:
          - dupl
          - gosec
          - unparam
          - errcheck

      # Allow unused parameters in interface implementations and HTTP handlers
      - linters:
          - unparam
        text: "always receives"
      - linters:
          - unparam
        text: "is unused"

issues:
  max-issues-per-linter: 50
  max-same-issues: 10
  new: false

severity:
  default: warning
  rules:
    - linters:
        - gosec
      severity: error
    - linters:
        - govet
      severity: error
