# ldapmerge

![Version](https://img.shields.io/github/v/release/dantte-lp/ldapmerge?style=flat-square)
![Go Version](https://img.shields.io/badge/Go-1.25-00ADD8?style=flat-square&logo=go)
![License](https://img.shields.io/badge/License-MIT-blue?style=flat-square)
![Build](https://img.shields.io/github/actions/workflow/status/dantte-lp/ldapmerge/build.yml?style=flat-square)

```
  ‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
  ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù
  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**LDAP Configuration Merger for VMware NSX 4.2**

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π LDAP —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å VMware NSX.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [API —Å–µ—Ä–≤–µ—Ä](#api-—Å–µ—Ä–≤–µ—Ä)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

```mermaid
flowchart LR
    subgraph Input["–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"]
        A["üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LDAP<br/>(–∏–∑ NSX –∏–ª–∏ —Ñ–∞–π–ª–∞)"]
        B["üîê –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã<br/>(–∏–∑ Ansible)"]
    end

    C["‚öôÔ∏è ldapmerge"]

    subgraph Output["–†–µ–∑—É–ª—å—Ç–∞—Ç"]
        D["üì§ NSX Manager"]
        E["üìÑ JSON —Ñ–∞–π–ª"]
    end

    A --> C
    B --> C
    C --> D
    C --> E
```

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| üîÑ **Sync** | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: pull ‚Üí merge ‚Üí push |
| üì• **Pull** | –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ NSX |
| üì§ **Push** | –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ NSX |
| üîÄ **Merge** | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ |
| ü©∫ **Probe** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LDAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π |
| üîê **Fetch Cert** | –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ |
| üîé **Search** | –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–≥—Ä—É–ø–ø |
| üåê **API Server** | REST API —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π Scalar |

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ò–∑ —Ä–µ–ª–∏–∑–æ–≤

```bash
# Linux
curl -L https://github.com/dantte-lp/ldapmerge/releases/latest/download/ldapmerge-linux-amd64.tar.gz | tar xz
sudo mv ldapmerge-linux-amd64 /usr/local/bin/ldapmerge

# macOS (Apple Silicon)
curl -L https://github.com/dantte-lp/ldapmerge/releases/latest/download/ldapmerge-darwin-arm64.tar.gz | tar xz
sudo mv ldapmerge-darwin-arm64 /usr/local/bin/ldapmerge

# Windows (PowerShell)
Invoke-WebRequest -Uri https://github.com/dantte-lp/ldapmerge/releases/latest/download/ldapmerge-windows-amd64.zip -OutFile ldapmerge.zip
Expand-Archive ldapmerge.zip -DestinationPath .
```

### Docker

```bash
docker pull ghcr.io/dantte-lp/ldapmerge:latest

docker run --rm ghcr.io/dantte-lp/ldapmerge:latest version
```

### –ò–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

```bash
git clone https://github.com/dantte-lp/ldapmerge.git
cd ldapmerge
make build
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å NSX

```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ñ–∞–π–ª —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ (response.json –∏–∑ Ansible)
ldapmerge sync \
  --host https://nsx-manager.example.com \
  -u admin \
  -P 'your-password' \
  -k \
  -r response.json
```

### –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```bash
ldapmerge merge \
  -i initial.json \
  -r response.json \
  -o result.json
```

### –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

```bash
ldapmerge server -p 8080

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8080/docs
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `sync` | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| `merge` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤ |
| `nsx pull` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ NSX |
| `nsx push` | –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ NSX |
| `nsx get` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ |
| `nsx delete` | –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ |
| `nsx probe` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å LDAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| `nsx fetch-cert` | –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç |
| `nsx search` | –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–≥—Ä—É–ø–ø |
| `server` | –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä |
| `version` | –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é |

### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ LDAP –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–∑ NSX
ldapmerge nsx pull --host https://nsx.example.com -u admin -P pass -k

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å LDAP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ldapmerge nsx probe example.lab --host https://nsx.example.com -u admin -P pass -k

# –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å LDAP —Å–µ—Ä–≤–µ—Ä–∞
ldapmerge nsx fetch-cert ldaps://ad-01.example.lab:636 --host https://nsx.example.com -u admin -P pass -k

# –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
ldapmerge nsx search example.lab --query "john" --type USER --host https://nsx.example.com -u admin -P pass -k
```

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏

| –§–ª–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `--config` | –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É |
| `--log-dir` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤ |
| `--log-level` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: debug, info, warn, error |
| `--log-console` | –í—ã–≤–æ–¥–∏—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å |

---

## API —Å–µ—Ä–≤–µ—Ä

```bash
ldapmerge server --port 8080 --db /var/lib/ldapmerge/data.db
```

### Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `POST` | `/api/merge` | –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| `GET` | `/api/history` | –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |
| `GET` | `/api/history/{id}` | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å |
| `GET` | `/api/configs` | –°–ø–∏—Å–æ–∫ NSX –∫–æ–Ω—Ñ–∏–≥–æ–≤ |
| `POST` | `/api/configs` | –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ |
| `DELETE` | `/api/configs/{id}` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ |
| `GET` | `/api/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è |
| `GET` | `/docs` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Scalar |

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X POST http://localhost:8080/api/merge \
  -H "Content-Type: application/json" \
  -d '{
    "initial": [...],
    "response": {...}
  }'
```

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| [QUICK_START.md](docs/QUICK_START.md) | –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç |
| [CLI.md](docs/CLI.md) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CLI |
| [API.md](docs/API.md) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API |
| [CHANGELOG.md](CHANGELOG.md) | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.25+
- Make

### –°–±–æ—Ä–∫–∞

```bash
# –°–æ–±—Ä–∞—Ç—å –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
make build

# –°–æ–±—Ä–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
make build-all

# –°–æ–±—Ä–∞—Ç—å —Å –≤–µ—Ä—Å–∏–µ–π
make VERSION=1.0.0 build-all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make test

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑–Ω—ã–µ –∞—Ä—Ö–∏–≤—ã
make release
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ldapmerge/
‚îú‚îÄ‚îÄ cmd/ldapmerge/       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/             # REST API —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ cli/             # Cobra –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ logging/         # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏
‚îÇ   ‚îú‚îÄ‚îÄ merger/          # –õ–æ–≥–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/          # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ nsx/             # NSX API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock/        # Mock —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ repository/      # SQLite —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ version/         # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏
‚îú‚îÄ‚îÄ docs/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ build/               # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–∏
‚îú‚îÄ‚îÄ Makefile             # –°–±–æ—Ä–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ go.mod               # Go –º–æ–¥—É–ª—å
```

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –°–º. [LICENSE](LICENSE).

---

## –°—Å—ã–ª–∫–∏

- [VMware NSX 4.2 API](https://developer.broadcom.com/xapis/nsx-t-data-center-rest-api/4.2/)
- [Scalar API Documentation](https://scalar.com/)
- [Huma REST Framework](https://huma.rocks/)
